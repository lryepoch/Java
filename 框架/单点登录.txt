
##配置文件
sso.properties:
	appId=			//单点登录appId
	appKey=			//单点登录appkey
	getTokenUrl=		//单点登录获取token的url;		callback/appid/appkey
	getUserInfoUrl=		//单点登录获取用户信息url；	token/appid/appkey/ip
	logoutUrl=			//单点登录退出url;			token/appid/appkey/ip


data.properties:
	indexUrl=		//单点登录重定向url；
	noAuthorityUrl=


##工具类LoginUtils.java读取sso.properties
##工具类InitStatus.java读取data.properties


##登录接口
void logincb(String callback, HttpServletRequest request, HttpServletResponse response){
	//先获取token
	tokenUrl->String.format(tokenUrl, callback, appid, appkey)
	token=getSsoToken(tokenUrl)
	//没有则重定向到登录页面
	if(token==null) {
		sendRedirect(loginUrl)
	}

	if(token->true){
		//获取登录用户ip
		ip = getIpAddr(request)
		infoUrl->String.format(infoUrl,token("Message"),appid,appkey,ip)
		//获取token后，获取用户信息
		getSsoUserInfo(infoUrl)

		if(ssoUserInfo->true){
			//从token中找到邮箱
			appAccount = get("AppAccount")
			//根据邮箱从数据库获取用户全部信息
			user = getUserByAppAccount(appAccount)
			if(user信息无效){
				//跳转到无权限页面
				sendRedirect(noAuthorityUrl)
			}
			//把当前用户ip加到ssoUserInfo中
			put("loginIp",ip);
			//在session中设置好当前用户信息，其他地方需要使用
			request.getSession().setAttribute("ssoUserInfo", ssoUserInfo)

			//根据ssoUserInfo，更新数据库中当前用户信息
			user.setUserName()
			user.setDepartment()
			user.setCompany()
			user.setJob()
			updateUser(user)

			//登录日志也可在此写入数据库

			saveToken(request,加密？)
			//登陆成功，跳转到首页地址
			response.sendRedirect(indexUrl)
		}
	}
}


##登出接口(获取ip、token)
logout(HttpServletRequest request){
	getIpAddr(request)
	String.format(logoutUrl, token, appid, appkey, ip)
	session.removeAttribute("ssoUserInfo")
}


##判断session是否过期
checkSession(HttpServletRequest request){
	request.getSession().getAttribute("ssoUserInfo").get("AppAccount");是否存在
}


##获取用户信息
getCurrentUserInfo(HttpServletRequest request){
	request.getSession().getAttribute("ssoUserInfo").get("AppAccount");获取邮箱号
}


##获取IP地址：
String getIpAddr(HttpServletRequest request){
	return string
}



##发送get请求：
String sendGet(String fullurl){
	in = new BufferedReader(new InputStreamReader(connection.getInputStream(),"utf-8"))	
}
##发送get请求返回的String转换成Map：
Map httpGet(String url){
	string->map
}


##获取用户token：
Map getSsoToken(String url){
	httpGet(String url)
}
##获取用户信息：
Map getSsoUserInfo(String url){
	httpGet(String url)
}
##退出单点登录：
Map getSsoOut(String url){
	httpGet(String url)
}